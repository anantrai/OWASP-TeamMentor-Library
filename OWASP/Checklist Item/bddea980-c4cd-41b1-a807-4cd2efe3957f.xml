<?xml version="1.0" encoding="utf-8"?><guidanceItem id="bddea980-c4cd-41b1-a807-4cd2efe3957f" type="checklist" title="All Database Input is Validated" cssFile="guidance.css" Date="2010-12-29T22:48:21.03125Z" Author="" Category="Data Access" filePath="..\Libraries\OWASP\Checklist Item\bddea980-c4cd-41b1-a807-4cd2efe3957f.xml" Priority="2" Rule_Type="Implementation" Source="SI" Status="" Technology="Java" Topic="Security" Type="Checklist Item" xmlns="urn:microsoft:guidanceexplorer:guidanceItem"><content><![CDATA[<H1>What to Check For</H1><P>Ensure that all input passed to the database is validated.</P><H1>Why</H1><P>Unvalidated input can lead to persistent cross-site scripting, SQL injection and other vulnerabilities&nbsp;that would allow an attacker to gain unauthorized access to sensitive data.</P><H1>How to Check</H1><P>Use the following steps to check if all input passed to database is validated:</P><OL><LI><P><STRONG>Identify database entry points. </STRONG>Identify all locations within your application that interface with the database servers. Potential sources of input include:</P><UL><LI>URL based parameters <LI>Form based parameters <LI>Hidden fields <LI>Cookies <LI>Local filesystem <LI>Javascript variables</LI></UL><LI><P><STRONG>Trace data from source to sink. </STRONG>Trace each source of input from the immediate source, through your application and&nbsp;to the backend database.</P><LI><P><STRONG>Identify validation routines. </STRONG>Each input source should have a validation routine associated with it. Ideally the validation will occur as soon as the input reaches your application. Shared validation routines are better than creating many throughout the code base, so check for consolidation of routines to aid testing and reduce the chance of one-off bugs. If any input source does not have a validation routine associated with it, flag it for fixing.</P><LI><P><STRONG>Ensure quality of validators. </STRONG>Validation routines should check for length, range, format and type.&nbsp;The validator&nbsp;should first check for good data&nbsp;via whitelisting and then for known malicious data&nbsp;via blacklisting. Do not rely on client-side validation alone as it can be bypassed easily. For more information see Checklist Item: <A href="ruledisplay:6D944640-22E7-421F-8192-45730D5118AB">Input is Validated for Length, Range, Format and Type</A>.</P><LI><P><STRONG>Ensure that parameterized queries are used. </STRONG>Using the <A href="ruledisplay:AA3B4801-99BA-43B0-90A6-D38A605E8574">Type Safe SQL Parameters are Used</A> checklist, verify that all database transactions are handled using <STRONG>PreparedStatement</STRONG> objects.</P></LI></OL><H1>Problem Example</H1><P>The following code allows the user to query a database. Unfortunately, the application fails to validate the user's input; therefore, an attacker can access the backend database on behalf of the application through the use of SQL injection. </P><BLOCKQUOTE><PRE>public void doGet(HttpServletRequest request,<BR>     HttpServletResponse response) throws ServletException, IOException<BR>&#123;<BR>     PrintWriter out = response.getWriter();<BR>     String query = request.getParameter("query");<BR>     String retData = "";<BR>      // The application fails to validate the user-supplied<BR>      // query before submitting it to the database server<BR>     retData = queryDB(query);<BR>      ...<BR>     out.flush();<BR>     out.close();<BR>&#125;</PRE></BLOCKQUOTE><H1>Additional Resources</H1><UL><LI>A tutorial on regular expressions is available at: <A href="http://www.regular-expressions.info/">Regular-Expressions.info</A>. <LI>For more information on using regular expression in Java, see: <A href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html">Class Pattern</A> in Java SDK. </LI></UL><H1>Related Guideline</H1><UL><LI><A href="ruledisplay:81491E66-67B7-49F3-BDA6-4B4C9245C702">Guideline: Validate All Input Passed to Database (Java Web Application)</A> </LI></UL>
]]></content></guidanceItem>