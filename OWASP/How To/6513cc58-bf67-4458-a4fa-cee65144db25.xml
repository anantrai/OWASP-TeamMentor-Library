<?xml version="1.0" encoding="utf-8"?><guidanceItem id="6513cc58-bf67-4458-a4fa-cee65144db25" type="howto" title="How to Use Regular Expressions to Constrain Input in ASP.NET" cssFile="guidance.css" Date="2010-03-03T21:45:14.512375Z" Author="" Category="Input and Data Validation" filePath="..\Libraries\OWASP\How To\6513cc58-bf67-4458-a4fa-cee65144db25.xml" Priority="" Rule_Type="Implementation" Source="ASP.NET 3.5" Status="" Technology="ASP.NET 3.5" Topic="Security" Type="How To" xmlns="urn:microsoft:guidanceexplorer:guidanceItem"><content><![CDATA[<H1>Summary</H1><P>This How to shows how you can use regular expressions within ASP.NET applications to constrain untrusted input. Regular expressions are a good way to validate text fields such as names, addresses, phone numbers, and other user information. You can use them to constrain input, apply formatting rules, and check lengths. To validate input captured with server controls, you can use the <B>RegularExpressionValidator</B> control. To validate other forms of input, such as query strings, cookies, and HTML control input, you can use the <B>System.Text.RegularExpressions.Regex</B> class.</P><P>This How to shows how you can use regular expressions within ASP.NET applications to constrain untrusted input.</P><H1>Contents</H1><UL><LI><DIV>Objectives</DIV><LI><DIV>Overview</DIV><LI><DIV>Using a RegularExpressionValidator Control</DIV><LI><DIV>Using the Regex Class</DIV><LI><DIV>Common Regular Expressions</DIV><LI><DIV>Additional Resources</DIV></LI></UL><H1>Objectives</H1><UL><LI>Use regular expressions to constrain input, apply format rules, and check lengths. <LI>Use the ASP.NET <B>RegularExpressionValidator</B> control to constrain and validate input. <LI>Use the <B>Regex</B> class to constrain and validate input. <LI>Learn common regular expressions that can be used to constrain input. </LI></UL><H1>Overview</H1><P>If you make unfounded assumptions about the type, length, format, or range of input, your application is unlikely to be robust. Input validation can become a security issue if an attacker discovers that you have made unfounded assumptions. The attacker can then supply carefully crafted input that compromises your application by attempting SQL injection, cross-site scripting, and other injection attacks. To avoid such vulnerability, you should validate text fields (such as names, addresses, tax identification numbers, and so on) and use regular expressions to do the following: </P><UL><LI>Constrain the acceptable range of input characters. <LI>Apply formatting rules. For example, pattern-based fields, such as tax identification numbers, ZIP Codes, or postal codes, require specific patterns of input characters. <LI>Check lengths. </LI></UL><P>Regular expression support is available to ASP.NET applications through the <B>RegularExpressionValidator</B> control and the <B>Regex</B> class in the <B>System.Text.RegularExpressions</B> namespace.</P><H1>Using a RegularExpressionValidator Control</H1><P>If you capture input by using server controls, you can use the <B>RegularExpressionValidator</B> control to validate that input. You can use regular expressions to restrict the range of valid characters, to strip unwanted characters, and to perform length and format checks. You can constrain the input format by defining patterns that the input must match.</P><H2>To validate a server control's input using a RegularExpressionValidator </H2><OL><LI>Add a <B>RegularExpressionValidator</B> control to your page. <LI>Set the <B>ControlToValidate</B> property to indicate which control to validate. <LI>Set the <B>ValidationExpression</B> property to an appropriate regular expression. <LI>Set the <B>ErrorMessage</B> property to define the message to display if the validation fails. </LI></OL><P>The following example shows a <B>RegularExpressionValidator</B> control used to validate a name field.</P><DIV><PRE>&lt;&#37;&#64; language="C#" &#37;&gt;<BR>&lt;form id="form1" runat="server"&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;asp:TextBox ID="txtName" runat="server"/&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;asp:Button ID="btnSubmit" runat="server" Text="Submit" /&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;asp:RegularExpressionValidator ID="regexpName" runat="server"&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ErrorMessage="This expression does not validate." <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ControlToValidate="txtName"&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ValidationExpression="&#94;&#91;a-zA-Z'.\s&#93;&#123;1,40&#125;&#36;" /&gt;<BR>&lt;/form&gt;  </PRE></DIV><P>The regular expression used in the preceding code example constrains an input name field to alphabetic characters (lowercase and uppercase), space characters, the single quotation mark (or apostrophe) for names such as O'Dell, and the period or dot character. In addition, the field length is constrained to 40 characters.</P><H2>Using &#94; and &#36;</H2><P>Enclosing the expression in the caret (<B>&#94;</B>) and dollar sign (<B>&#36;)</B>markers ensures that the expression consists of the desired content and nothing else. A <B>&#94;</B> matches the position at the beginning of the input string and a <B>&#36;</B> matches the position at the end of the input string. If you omit these markers, an attacker could affix malicious input to the beginning or end of valid content and bypass your filter.</P><H1>Using the Regex Class</H1><P>If you are not using server controls (which means you cannot use the validation controls) or if you need to validate input from sources other than form fields, such as query string parameters or cookies, you can use the <B>Regex</B> class within the <B>System.Text.RegularExpressions</B> namespace.</P><H2>To use the Regex class </H2><OL><LI>Add a <B>using</B> statement to reference the <B>System.Text.RegularExpressions</B> namespace. <LI>Call the <B>IsMatch</B> method of the <B>Regex</B> class, as shown in the following example. <DIV><PRE>// Instance method:<BR>Regex reg = new Regex(&#64;"&#94;&#91;a-zA-Z'.&#93;&#123;1,40&#125;&#36;");<BR>Response.Write(reg.IsMatch(txtName.Text));<BR>// Static method:<BR>if (&#33;Regex.IsMatch(txtName.Text, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#64;"&#94;&#91;a-zA-Z'.&#93;&#123;1,40&#125;&#36;"))<BR>&#123;<BR>&nbsp; // Name does not match schema<BR>&#125;  </PRE></DIV></LI></OL><P>For performance reasons, you should use the static <B>IsMatch</B> method where possible to avoid unnecessary object creation.</P><P>The following example shows how to use a regular expression to validate a name input through a regular client-side HTML control.</P><DIV><PRE>&lt;&#37;&#64; Page Language="C#" &#37;&gt;</PRE><PRE>&lt;html&nbsp; &gt;<BR>&nbsp; &lt;body&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;form id="form1" method="post" action="HtmlControls.aspx"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;input name="txtName" type="text" /&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;input name="submitBtn" type="Submit" value="Submit"/&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;/form&gt;<BR>&nbsp; &lt;/body&gt;<BR>&lt;/html&gt;</PRE></DIV><PRE>&lt;script runat="server"&gt;</PRE><PRE>&nbsp; void Page_Load(object sender, EventArgs e)<BR>&nbsp; &#123;<BR>&nbsp;&nbsp;&nbsp; if (Request.RequestType == "POST")<BR>&nbsp;&nbsp;&nbsp; &#123;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string name = Request.Form&#91;"txtName"&#93;;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (name.Length &gt; 0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (System.Text.RegularExpressions.Regex.IsMatch(name, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "&#94;&#91;a-zA-Z'.&#93;&#123;1,40&#125;&#36;"))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Response.Write("Valid name");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Response.Write("Invalid name");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;<BR>&nbsp;&nbsp;&nbsp; &#125;<BR>&nbsp; &#125;</PRE><PRE>&lt;/script&gt;  </PRE><H2>Use Regular Expression Comments</H2><P>Regular expressions are much easier to understand if you use the following syntax and comment each component of the expression by using a number sign (<B>#</B>). To enable comments, you must also specify <B>RegexOptions.IgnorePatternWhitespace</B>, which means that non-escaped white space is ignored.</P><DIV><PRE>Regex regex = new Regex(&#64;"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#94;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # anchor at the start<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (?=.&#42;\d)&nbsp;&nbsp;&nbsp;&nbsp; # must contain at least one numeric character<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (?=.&#42;&#91;a-z&#93;)&nbsp; # must contain one lowercase character<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (?=.&#42;&#91;A-Z&#93;)&nbsp; # must contain one uppercase character<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&#123;8,10&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # From 8 to 10 characters in length<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # allows a space <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#36;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # anchor at the end", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RegexOptions.IgnorePatternWhitespace);  </PRE></DIV><H1>Common Regular Expressions</H1><P>Some common regular expressions are shown in Table 1.</P><P><B>Table 1. Common Regular Expressions</B></P><DIV><TABLE><TBODY><TR><TH>Field </TH><TH>Expression</TH><TH>Format Samples</TH><TH>Description</TH></TR><TR><TD>Name</TD><TD>&#94;&#91;a-zA-Z''-'\s&#93;&#123;1,40&#125;&#36;</TD><TD>John Doe<BR>O'Dell</TD><TD>Validates a name. Allows up to 40 uppercase and lowercase characters and a few special characters that are common to some names. You can modify this list.</TD></TR><TR><TD>Social Security Number</TD><TD>&#94;\d&#123;3&#125;-\d&#123;2&#125;-\d&#123;4&#125;&#36;</TD><TD>111-11-1111</TD><TD>Validates the format, type, and length of the supplied input field. The input must consist of 3 numeric characters followed by a dash, then 2 numeric characters followed by a dash, and then 4 numeric characters.</TD></TR><TR><TD>Phone Number</TD><TD>&#94;&#91;01&#93;?&#91;- .&#93;?(\(&#91;2-9&#93;\d&#123;2&#125;\)&#124;&#91;2-9&#93;\d&#123;2&#125;)&#91;- .&#93;?\d&#123;3&#125;&#91;- .&#93;?\d&#123;4&#125;&#36;</TD><TD>(425) 555-0123<BR>425-555-0123<BR>425 555 0123<BR>1-425-555-0123</TD><TD>Validates a U.S. phone number. It must consist of 3 numeric characters, optionally enclosed in parentheses, followed by a set of 3 numeric characters and then a set of 4 numeric characters. </TD></TR><TR><TD>E-mail </TD><TD>&#94;(&#91;0-9a-zA-Z&#93;(&#91;-.\w&#93;&#42;&#91;0-9a-zA-Z&#93;)&#42;&#64;(&#91;0-9a-zA-Z&#93;&#91;-\w&#93;&#42;&#91;0-9a-zA-Z&#93;\.)&#43;&#91;a-zA-Z&#93;&#123;2,9&#125;)&#36;</TD><TD>someone&#64;example.com</TD><TD>Validates an e-mail address.</TD></TR><TR><TD>URL</TD><TD>&#94;(ht&#124;f)tp(s?)\:\/\/&#91;0-9a-zA-Z&#93;(&#91;-.\w&#93;&#42;&#91;0-9a-zA-Z&#93;)&#42;(:(0-9)&#42;)&#42;(\/?)(&#91;a-zA-Z0-9\-\.\?\,\'\/\\\&#43;&amp;amp;&#37;\&#36;#_&#93;&#42;)?&#36;</TD><TD>http://www.microsoft.com</TD><TD>Validates a URL </TD></TR><TR><TD>ZIP Code</TD><TD>&#94;(\d&#123;5&#125;-\d&#123;4&#125;&#124;\d&#123;5&#125;&#124;\d&#123;9&#125;)&#36;&#124;&#94;(&#91;a-zA-Z&#93;\d&#91;a-zA-Z&#93; \d&#91;a-zA-Z&#93;\d)&#36;</TD><TD>12345</TD><TD>Validates a U.S. ZIP Code. The code must consist of 5 or 9 numeric characters.</TD></TR><TR><TD>Password</TD><TD>(?&#33;&#94;&#91;0-9&#93;&#42;&#36;)(?&#33;&#94;&#91;a-zA-Z&#93;&#42;&#36;)&#94;(&#91;a-zA-Z0-9&#93;&#123;8,10&#125;)&#36;</TD><TD>&nbsp;</TD><TD>Validates a strong password. It must be between 8 and 10 characters, contain at least one digit and one alphabetic character, and must not contain special characters.</TD></TR><TR><TD>Non- negative integer</TD><TD>&#94;\d&#43;&#36;</TD><TD>0<BR>986</TD><TD>Validates that the field contains an integer greater than zero.</TD></TR><TR><TD>Currency (non- negative)</TD><TD>&#94;\d&#43;(\.\d\d)?&#36;</TD><TD>1.00</TD><TD>Validates a positive currency amount. If there is a decimal point, it requires 2 numeric characters after the decimal point. For example, 3.00 is valid but 3.1 is not.</TD></TR><TR><TD>Currency (positive or negative)</TD><TD>&#94;(-)?\d&#43;(\.\d\d)?&#36;</TD><TD>1.20</TD><TD>Validates for a positive or negative currency amount. If there is a decimal point, it requires 2 numeric characters after the decimal point.</TD></TR></TBODY></TABLE></DIV><H1>Additional Resources</H1><UL><LI>For more information, see the regular expression tutorial at <A href="http://www.regular-expressions.info/tutorial.html">http://www.regular-expressions.info/tutorial.html</A>.</LI></UL><HR><P>Adapted from Microsoft patterns &amp; practices guidance.</P>

]]></content></guidanceItem>